3. Fetch the six hourly parameters.  
4. Aggregate them to show:
- Total Fabric Produced  
- Total Runtime / Downtime / Idle Time / Energy  
- Average OEE  
- Hourly table and Plotly trend  

---

### ðŸ§  Add this script **before `</body>`**
*(Below your last closing `</div>` and above `</body>`)*

```html
<script>
/* ===== CONFIG ===== */
const CONFIG = {
API_BASE_URL: "https://plantwiz.pimateck.in/api",   // âœ… change if self-hosted
KEYS: [
 "Meter_Run_Hourly",
 "Consumption_Hourly",
 "Runtime_Hourly",
 "Downtime_Hourly",
 "Idletime_Hourly",
 "Oee_Hourly"
]
};

/* ====== TOKEN & DEVICE FROM URL ====== */
const qs = new URLSearchParams(location.search);
const JWT = qs.get("token") || "";
const DEVICE_ID = qs.get("deviceId") || "";
if (!JWT || !DEVICE_ID) alert("Missing token or deviceId in URL");

/* ====== HELPER FUNCTIONS ====== */
function num(v){ const n = Number(v); return Number.isFinite(n)?n:0; }
function fmtTime(ts){ return new Date(ts).toLocaleTimeString([], {hour:"2-digit",minute:"2-digit"}); }

/* ====== FETCH DATA FROM THINGSBOARD ====== */
async function fetchHourlyData(){
const end = Date.now();
const start = end - 24*3600*1000;  // last 24 hours
const url = `${CONFIG.API_BASE_URL}/plugins/telemetry/DEVICE/${DEVICE_ID}/values/timeseries`
         + `?keys=${CONFIG.KEYS.join(",")}&startTs=${start}&endTs=${end}&limit=1000&agg=NONE`;

const res = await fetch(url, { headers: { "X-Authorization": `Bearer ${JWT}` }});
if(!res.ok) throw new Error(res.statusText);
const json = await res.json();
return json;
}

/* ====== MERGE SERIES BY TIMESTAMP ====== */
function mergeSeries(obj){
const map = new Map();
for(const [key,arr] of Object.entries(obj)){
 (arr||[]).forEach(p=>{
   const t = +p.ts;
   const row = map.get(t)||{ts:t};
   row[key] = num(p.value);
   map.set(t,row);
 });
}
return Array.from(map.values()).sort((a,b)=>a.ts-b.ts);
}

/* ====== RENDER UI ====== */
function renderKpis(rows){
const totalFabric = rows.reduce((s,r)=>s+num(r.Meter_Run_Hourly),0);
const totalRuntime = rows.reduce((s,r)=>s+num(r.Runtime_Hourly),0);
const totalDowntime = rows.reduce((s,r)=>s+num(r.Downtime_Hourly),0);
const totalIdle = rows.reduce((s,r)=>s+num(r.Idletime_Hourly),0);
const totalEnergy = rows.reduce((s,r)=>s+num(r.Consumption_Hourly),0);
const avgOee = rows.length?rows.reduce((s,r)=>s+num(r.Oee_Hourly),0)/rows.length:0;

document.getElementById("fabricProduced").textContent = totalFabric.toFixed(0) + " m";
document.getElementById("runtime").textContent = totalRuntime.toFixed(1);
document.getElementById("downtime").textContent = totalDowntime.toFixed(1);
document.getElementById("idle").textContent = totalIdle.toFixed(1);
document.getElementById("energy").textContent = totalEnergy.toFixed(1);
document.getElementById("oee").textContent = avgOee.toFixed(1) + " %";
}

/* ====== RENDER HOURLY TABLE ====== */
function renderTable(rows){
const tb=document.getElementById("hourlyTable");
tb.innerHTML="";
rows.forEach(r=>{
 const tr=document.createElement("tr");
 const cells=[
   fmtTime(r.ts),
   r.Meter_Run_Hourly?.toFixed(0),
   r.Runtime_Hourly?.toFixed(1),
   r.Downtime_Hourly?.toFixed(1),
   r.Idletime_Hourly?.toFixed(1),
   r.Consumption_Hourly?.toFixed(1),
   r.Oee_Hourly?.toFixed(1)
 ];
 cells.forEach(v=>{
   const td=document.createElement("td");
   td.textContent=v??"â€”";
   tr.appendChild(td);
 });
 tb.appendChild(tr);
});
}

/* ====== RENDER TREND CHART ====== */
function renderChart(rows){
if(!rows.length){ Plotly.purge("trendChart"); return; }
const t=rows.map(r=>new Date(r.ts));
const fabric=rows.map(r=>r.Meter_Run_Hourly);
const runtime=rows.map(r=>r.Runtime_Hourly);
const energy=rows.map(r=>r.Consumption_Hourly);
const downtime=rows.map(r=>r.Downtime_Hourly);
Plotly.newPlot("trendChart",[
 {x:t,y:fabric,name:"Fabric",mode:"lines",line:{color:"#38bdf8"}},
 {x:t,y:runtime,name:"Runtime",mode:"lines",line:{color:"#22c55e"}},
 {x:t,y:downtime,name:"Downtime",mode:"lines",line:{color:"#ef4444"}},
 {x:t,y:energy,name:"Energy",mode:"lines",line:{color:"#f59e0b"}}
],{
 paper_bgcolor:"#1e293b",
 plot_bgcolor:"#1e293b",
 font:{color:"#f1f5f9"},
 margin:{l:40,r:20,t:30,b:30},
 legend:{orientation:"h",y:-0.2}
},{displaylogo:false,responsive:true});
}

/* ===== MAIN FLOW ===== */
async function init(){
try{
 const json=await fetchHourlyData();
 const rows=mergeSeries(json);
 renderKpis(rows);
 renderTable(rows);
 renderChart(rows);
}catch(e){
 console.error(e);
 alert("Failed to load data: "+e.message);
}
}
window.addEventListener("load",init);
</script>
